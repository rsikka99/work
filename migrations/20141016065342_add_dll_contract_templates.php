<?php

use Phinx\Migration\AbstractMigration;

class AddDllContractTemplates extends AbstractMigration
{
    /**
     * Migrate Up.
     */
    public function up ()
    {
        $this->execute("INSERT INTO contract_sections (id, sectionDefaultName, sectionDefaultText) VALUES
                        (11, 'LESSEE', ''),
                        (12, 'PAYMENT INFORMATION', ''),
                        (13, 'TERMS AND CONDITIONS', '<p><b>1. Lease:</b> You (the \"Lessee\") agree to lease from us (the \"Lessor\") the Equipment listed above and on any attached schedule. You authorize us to adjust the Lease payments by up to 15% if the cost of the Equipment or taxes differs from the supplier'' estimate. This Lease is effective on the date that it is accepted and signed by us, and the term of this Lease begins on that date or any later date that we designate (the \"Commencement Date\") and continues thereafter for the number of months indicated above. Lease payments are due as invoiced by us. As you will have possession of the Equipment from the date of its delivery, if we accept and sign this Lease you will pay us interim rent for the period from the date the Equipment is delivered to you until the Commencement Date as reasonably calculated by us based on the Lease payment, the number of days in that period, and a month of 30 days. Your obligations to us are absolute, unconditional, and are not subject to cancellation, reduction, setoff or counterclaim. You agree to pay us a fee of $75.00 to reimburse our expenses for preparing financing statements, other documentation costs and all ongoing administration costs during the term of this Lease. Security deposits are non-interest-bearing and may be applied to cure a Lease default. If you are not in default, we will return the deposit to you when the Lease is terminated. If a payment is not made when due, you will pay us a late charge of 5% of the payment or $10.00, whichever is greater. We will charge you a fee of $25.00 for any check that is returned. ONLY WE ARE AUTHORIZED TO WAIVE OR CHANGE ANY TERM, PROVISION OR CONDITION OF THE LEASE.</p> <p><b>2. Title:</b> Unless you have a $1.00 purchase option, we will have title to the Equipment. If you have a $1.00 purchase option and/or the Lease is deemed to be a security agreement, you grant us a security interest in the Equipment and all proceeds thereof. You authorize us to file Uniform Commercial Code (\"UCC\") financing statements on the Equipment.</p> <p><b>3. Equipment Use, Maintenance and Warranties:</b> We are leasing the Equipment to you \"AS-IS\" AND MAKE NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WARRANTIES OF MERCHANTABILITY, OR FITNESS FOR A PARTICULAR PURPOSE. We transfer to you any manufacturer warranties. You are required at your cost to keep the Equipment in good working condition and to pay for all supplies and repairs. If the Lease payment includes the cost of maintenance and/or service provided by a third party, you agree that we are not responsible to provide the maintenance or service and you will make all claims related to maintenance and service to the third party. You agree that any claims related to maintenance or service will not impact your obligation to pay us all Lease payments when due.</p> <p><b>4. Assignment:</b> You agree not to transfer, sell, sublease, assign, pledge or encumber either the Equipment or any rights under this Lease without our prior written consent. You agree that we may sell, assign, or transfer the Lease and the new owner will have the same rights and benefits we now have and will not have to perform any of our obligations and the rights of the new owner will not be subject to any claims, defenses, or setoffs that you may have against us or any supplier.</p> <p><b>5. Risk of Loss and Insurance:</b> You are responsible for all risks of loss or damage to the equipment and if any loss occurs you are required to satisfy all of your Lease obligations. You will keep the Equipment insured against all risks of loss or damage for an amount equal to its replacement cost. You will list us as the sole loss payee for the insurance and give us written proof of the insurance. If you do not provide such insurance, you agree that we have the right, but not the obligation, to obtain such insurance, and add an insurance fee to the amount due from you, on which we make a profit. We are not responsible for any losses or injuries caused by the Equipment and you will reimburse us and defend us against any such claims. This indemnity will continue after the termination of this Lease. You will obtain and maintain comprehensive public liability insurance naming us as an additional insured with coverages and amounts acceptable to us.</p> <p><b>6. Taxes:</b> You agree to pay when due, either directly or as reimbursement to us, all sales, use and personal property taxes and charges in connection with ownership and use of the Equipment. We may charge you a processing fee for administering property tax filings. You will indemnify us on an after-tax basis against loss of any tax benefits anticipated at the Commencement Date arising out of your acts or omissions.</p> <p><b>7. End of Lease:</b> You will give us at least 60 days but not more than 120 days written notice (to our address below) before the expiration of the initial lease term (or any renewal term) of your intention to purchase or return the Equipment. With proper notice you may: a) purchase all the Equipment as indicated above under \"End of Lease Option\" (fair market value purchase option amounts will be determined by us based on the Equipment'' in place value); or b) return all the Equipment in good working condition at your cost in a timely manner, and to a location we designate. If you fail to notify us, or if you do not (i) purchase or (ii) return the Equipment as provided herein, this Lease will automatically renew at the same payment amount for consecutive 60-day periods.</p> <p><b>8. Default and Remedies</b> You are in default on this Lease if: a) you fail to pay a Lease payment or any other amount when due; or b) you breach any other obligation under the Lease or any other Lease with us. If you are in default on the Lease we may: (i) declare the entire balance of unpaid Lease payment for the full Lease term immediately due and payable to us; (ii) sue you for and receive the total amount due on the Lease plus the Equipment'' anticipated end of Lease fair market value or fixed price purchase option (the \"Residual\") with future Lease payments and the Residual discounted to the date of default at the lesser of (A) a per annum interest rate equivalent to that of a U.S. Treasury constant maturity obligation (as reported by the U.S. Treasury Department) that would have a repayment term equal to the remaining Lease term, all as reasonably determined by Lessor, or (B) 3% per annum, plus reasonable collection and legal costs; (iii) charge you interest on all monies at the rate of 18% per year or the highest rate permitted by law from the date of default; and (iv) require that you immediately return the Equipment to us or we may peaceably repossess it. Any return or repossession will not be considered a termination or cancellation of the Lease. If the equipment is returned or repossessed we will sell or re-rent the Equipment at terms we determine, at one or more public or private sales, with or without notice to you, and apply the net proceeds (after deducting any related expenses) to your obligations. You remain liable for any deficiency with any excess being retained by us.</p> <p><b>9. Miscellaneous:</b> You agree the Lease is a Finance Lease as defined in Article 2A of the UCC. You acknowledge we have given you the name of the Equipment supplier and that you may have rights under the contract with the supplier and may contact the supplier for a description of these rights. If requested, you will sign a separate Equipment acceptance certificate. <b>This Lease was made in Pennsylvania (\"PA\"), is to be performed in PA and shall be governed and construed in accordance with the laws of PA. You consent to jurisdiction, personal or otherwise, in any state or federal court in PA and irrevocably waive a trial by jury.</b> You agree to waive any and all rights and remedies granted to you under Sections 2A-508 through 2A-522 of the UCC. You agree that all the Equipment will only be used for business purposes and not for personal, family or household use, and will not be moved from the above location without our consent. You agree that a facsimile copy of the lease with facsimile signatures may be treated as an original and will be admissible as evidence of the Lease. We may inspect the Equipment during the Lease term.</p>'),
                        (14, 'LESSEE SIGNATURE', ''),
                        (15, 'LESSOR', '<p><b>De Lage Landen Financial Services, Inc.</b></p><p>Lease Processing Center, 1111 Old Eagle School Road, Wayne, PA 19087</p><p><b>PHONE: (800) 735-3273 FAX: (800) 776-2329</b></p>'),
                        (16, 'ACCEPTANCE', ''),
                        (17, 'GUARANTY', '<p>I unconditionally guaranty prompt payment of all the Lessee''s obligations under the Lease. The Lessor is not required to proceed against the Lessee or the Equipment or enforce other remedies before proceeding against me. I waive notice of acceptance and all other notices or demands of any kind to which I may be entitled. I consent to any extensions or modification granted to the Lessee and the release and/or compromise of any obligations of the Lessee or any other guarantors without releasing me from my obligations. This is a continuing guaranty and will remain in effect in the event of my death and may be enforced by or for the benefit of any assignee or successor of the Lessor. <b>This guaranty is governed by and constituted in accordance with the laws of the Commonwealth of PA and I consent to non-exclusive jurisdiction of any state or federal court in PA and waive trial by jury.</b></p>'),
                        (18, 'SCHEDULE', '');
        ");

        $this->execute("INSERT INTO contract_templates (id, dealerId, templateName, isSystemTemplate) VALUES
            (3, 1, 'De Lage Landen Lease Contract', TRUE);");

        $this->execute("INSERT INTO contract_template_sections (contractTemplateId, contractSectionId, enabled, sectionName, sectionText) VALUES
                        (3, 11, TRUE, '', ''),
                        (3, 12, TRUE, '', ''),
                        (3, 13, TRUE, '', ''),
                        (3, 14, TRUE, '', ''),
                        (3, 15, TRUE, '', ''),
                        (3, 16, TRUE, '', ''),
                        (3, 17, TRUE, '', ''),
                        (3, 18, TRUE, '', '');
        ");

        $this->execute("UPDATE contract_templates SET templateName = 'Great America Hardware Contract'       WHERE id = 1");
        $this->execute("UPDATE contract_templates SET templateName = 'Great America Hardware & MPS Contract' WHERE id = 2");

    }

    /**
     * Migrate Down.
     */
    public function down ()
    {
        $this->execute('DELETE FROM contract_sections WHERE id IN (11, 12, 13, 14, 15, 16, 17, 18)');
        $this->execute('DELETE FROM contract_template_sections WHERE contractSectionId = 3');
        $this->execute('DELETE FROM contract_templates WHERE id = 3');

        $this->execute("UPDATE contract_templates SET templateName = 'Default Hardware Contract'                  WHERE id = 1");
        $this->execute("UPDATE contract_templates SET templateName = 'Default Combined Hardware And MPS Contract' WHERE id = 2");

    }
}