<div class="page-header">
    <h1>Lease Rate Manangement</h1>
</div>
<?php $leasingSchema = $this->leasingSchema; /* @var $leasingSchema Quotegen_Model_LeasingSchema */ ?>

<?php if( isset( $this->errMessages ) ) {
	// show the first error in the list of errors
	echo '<div class="alert alert-error">';
	foreach($this->errMessages as $key => $value) {
		echo $value;
	}
	echo '</div>';
} ?>
<div class="well">
<?php if ( $leasingSchema ) : ?>
    <div class="clearfix">
        <div class="pull-right">
			<a class="btn btn-inverse" title="Clear Schema" href="<?php echo $this->url( array ( 'action' => 'resetschema') ); ?>">
				<i class="icon-exclamation-sign icon-white"></i> Clear Schema
			</a>
		</div>
    </div>
	<div style="overflow: auto; overflow-y: hidden; -ms-overflow-y: hidden; margin: 20px 0px 0px 0px;">
	
        <table id="leasingSchemaTable" class="table table-striped table-bordered">
    	    <thead>
    			<tr>
    				<th nowrap="nowrap" style="min-width: 80px; text-align: center;">Term (months) </th>
    				<?php foreach ($leasingSchema->getRanges() as $range ) : ?>
    					<?php if ($range->getStartRange() == 0) : ?>
    						<th style="min-width: 80px; text-align: center;">$0+ </th>
    					<?php else : ?>
    						<th style="min-width: 80px; text-align: center;"><?php echo $this->currency($range->getStartRange()); ?>+ </th>
    					<?php endif; ?>
    				<?php endforeach; ?>
    				<th nowrap="nowrap" style="min-width: 80px; text-align: center;">Action</th>
    			</tr>
    	    </thead>
    	    <tbody>
    	      <?php
    	          // Loop through the terms and rates 
    	          $rates = $leasingSchema->getRates(); 
              ?>
            <?php foreach ( $leasingSchema->getTerms() as $term ) : /* @var $term Quotegen_Model_LeasingSchemaTerm */ ?>
                <tr>
        	        <td style="text-align: center;">
        	        	<?php echo $term->getMonths(); ?> months
        	        </td>
        	        
                <?php foreach ( $leasingSchema->getRanges() as $range ) : /* @var $range Quotegen_Model_LeasingSchemaRange */ ?>
                    <td style="text-align: center;"><?php echo number_format($rates[$term->getId()][$range->id]->getRate(), 4); ?></td>
                <?php endforeach; ?>
                
                    <td style="text-align: center;">
        		      	<a class="btn btn-warning btn-mini" title="Edit Term" href="<?php echo $this->url( array ( 'action' => 'editterm', 'id' => $term->getId()) ); ?>">
        					<i class="icon-pencil icon-white"></i>
        				</a>
    				<?php if ( count ( $leasingSchema->getTerms() ) > 1 ) : ?>
        		      	<a class="btn btn-danger btn-mini" title="Delete Term" href="<?php echo $this->url( array ( 'action' => 'deleteterm', 'id' => $term->getId()) ); ?>">
        					<i class="icon-trash icon-white"></i>
        				</a>
    				<?php endif; ?>
                    </td>
                </tr>
            <?php endforeach; ?>
                <tr>
    	      	    <td></td>
      	    <?php foreach ($leasingSchema->getRanges() as $range ) : /* @var $range Quotegen_Model_LeasingSchemaRange */ ?> 
                    <td style="text-align: center;">
    		      	    <a class="btn btn-warning btn-mini" title="Edit Range" href="<?php echo $this->url( array ( 'action' => 'editrange', 'id' => $range->id) ); ?>">
    						<i class="icon-pencil icon-white"></i>
    					</a>
				    <?php if ($range->startRange != 0) : ?>
    			      	<a class="btn btn-danger btn-mini" title="Delete Range" href="<?php echo $this->url( array ( 'action' => 'deleterange', 'id' => $range->id) ); ?>">
    						<i class="icon-trash icon-white"></i>
    					</a>
					<?php endif; ?>
    		        </td>
            <?php endforeach; ?>
      			    <td style="text-align: center;">&nbsp;</td>
                </tr>
            </tbody>
        </table>
	</div>
	
	<div class="clearfix">
    	<span class="pull-right">
          	<a class="btn btn-success" title="Add Term" href="<?php echo $this->url( array ( 'action' => 'addterm') ); ?>"><i class="icon-plus-sign icon-white"></i> Add Term</a>
          	<a class="btn btn-success" title="Add Range" href="<?php echo $this->url( array ( 'action' => 'addrange') ); ?>"><i class="icon-plus-sign icon-white"></i> Add Range</a>
    	</span>
	</div>
<?php else : ?>
	<h2>There is no Leasing Schema Data available.</h2>
<?php endif; ?>
</div>