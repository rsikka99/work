<?php $leasingSchema = $this->leasingSchema; /* @var $leasingSchema Quotegen_Model_LeasingSchema */ ?>

<?php $this->headScript()->captureStart('append','text/javascript') ?>
	
	$(document).ready(function() {
	
	});
	
	function do_action(mode, id) {
		switch (mode) {
			case "add term":
				document.location.href = 'leasingschema/addterm';
				break;
			case "edit term":
				document.location.href = 'leasingschema/editterm/id/'+id;
				break;
			case "add range":
				document.location.href = 'leasingschema/addrange';
				break;
			case "edit range":
				document.location.href = 'leasingschema/editrange/id/'+id;
				break;
			case "delete term":
				document.location.href = 'leasingschema/deleteterm/id/'+id;
				break;
			case "delete range":
				document.location.href = 'leasingschema/deleterange/id/'+id;
				break;
			case "reset":
				document.location.href = 'leasingschema/resetschema';
				break;
			case "import":
				$("#leasingSchemas").submit();
				break;
		}
	}
	
<?php $this->headScript()->captureEnd() ?>

<?php if( isset( $this->errMessages ) ) {
	// show the first error in the list of errors
	echo '<div class="alert alert-error">';
	foreach($this->errMessages as $key => $value) {
		echo $value;
	}
	echo '</div>';
} ?>

<h1>Leasing Schema</h1>

<div class="well">

	<form name="leasingSchemas" id="leasingSchemas" class="form-horizontal" action="" method="post" enctype="multipart/form-data">
		
		<?php if ( $leasingSchema ) { ?>
				
		<p>You can Upload a new schema or Edit the current schema below. </p>
		<p><strong>Note:</strong> Uploading a new schema will remove the existing schema and replace it with what you are uploading. This action can not be undone.</p>
		
	    <div id="upload_container" style="margin: 10px 0px 10px 0px;">
			<span class="pull-left">
        		Choose a <span style="color: red">.CSV</span> file to upload: 
        		<input type="file" name="uploadedfile" id="uploadedfile" accept="application/csv, text/csv" size="60" class="upload_file" />
        	</span>
			<span class="">
		      	<a class="btn" title="Import" onclick="javascript: do_action('import');">
					<i class="icon-upload"></i> Upload
				</a>
			</span>
	    	<span class="pull-right">
				<a class="btn btn-inverse" title="Clear Schema" onclick="javascript: do_action('reset', 0);">
					<i class="icon-exclamation-sign icon-white"></i> Clear Schema
				</a>
			</span>
	    </div>
		
		<div style="clear: both;"></div>
		
		<div id="lease-terms-container" style="overflow: auto; overflow-y: hidden; -ms-overflow-y: hidden; margin: 20px 0px 0px 0px;">
		
		  	<table id="leasingSchemaTable" class="table table-striped table-bordered">
		    <thead id="leadingSchemaHeaders">
				<tr>
					<th nowrap="nowrap" style="min-width: 80px; text-align: center;">Term (months) </th>
					<?php foreach ($leasingSchema->getRanges() as $range ) {
					    $rangeid = $range->getId();
					    $startRange = $range->getStartRange();
					
						if ($startRange == 0) { ?>
							<th style="min-width: 80px; text-align: center;">$0+ </th>
						<?php } else { ?>
							<th style="min-width: 80px; text-align: center;"><?php echo $this->currency($startRange); ?>+ </th>
						<?php } ?>
					<?php } ?>
					<th nowrap="nowrap" style="min-width: 80px; text-align: center;">Action</th>
				</tr>
		    </thead>
		    
		    <tbody id="leasingSchemaData">
		      <!-- LOOP THROUGH TERMS AND DISPLAY ROWS -->
		      <?php $colcount = 1; ?>
		      <?php $rates = $leasingSchema->getRates(); ?>
		      <?php foreach ( $leasingSchema->getTerms() as $term ) {
		          $termid = $term->getId();
		          $month = $term->getMonths();
		      ?>
		      <tr id="term-<?php echo $termid; ?>">
		        <td style="text-align: center;">
		        	<?php echo $month; ?> months
		        </td>
		        <?php foreach ( $leasingSchema->getRanges() as $range ) {
		            $colcount += 1;
	            	$rangeid = $range->getId();
		        ?>
		        <td style="text-align: center;"><?php echo $rates[$termid][$rangeid]->getRate(); ?></td>
		        <?php } ?>
		        <td style="text-align: center;">
			      	<a class="btn btn-warning btn-mini" title="Edit Term" onclick="javascript: do_action('edit term', <?php echo $termid; ?>);">
						<i class="icon-pencil icon-white"></i>
					</a>
					<?php if ( count ( $leasingSchema->getTerms() ) > 1 ) { ?>
			      	<a class="btn btn-danger btn-mini" title="Delete Term" onclick="javascript: do_action('delete term', <?php echo $termid; ?>);">
						<i class="icon-trash icon-white"></i>
					</a>
					<?php } ?>
		        </td>
		      </tr>
		      <?php } ?>
		      <!-- END LOOP THROUGH TERMS AND DISPLAY ROWS -->
		      <tr>
		      	<td>&nbsp;</td>
				<?php foreach ($leasingSchema->getRanges() as $range ) { 
					$rangeid = $range->getId();
					$startRange = $range->getStartRange();

					if ($startRange == 0) { ?>
		      			<td style="text-align: center;">
					      	<a class="btn btn-warning btn-mini" title="Edit Range" onclick="javascript: do_action('edit range', <?php echo $rangeid; ?>);">
								<i class="icon-pencil icon-white"></i>
							</a>
						</td>
					<?php } else { ?>
				        <td style="text-align: center;">
					      	<a class="btn btn-warning btn-mini" title="Edit Range" onclick="javascript: do_action('edit range', <?php echo $rangeid; ?>);">
								<i class="icon-pencil icon-white"></i>
							</a>
					      	<a class="btn btn-danger btn-mini" title="Delete Range" onclick="javascript: do_action('delete range', <?php echo $rangeid; ?>);">
								<i class="icon-trash icon-white"></i>
							</a>
				        </td>
					<?php } ?>
		        <?php } ?>
      			<td style="text-align: center;">&nbsp;</td>
		      </tr>
		    </tbody>
		  	</table>
		</div>
		
		<div id="buttons_container">
			<span class="pull-right">
		      	<a class="btn btn-success" title="Add Term" onclick="javascript: do_action('add term', 0);" href="#">
					<i class="icon-plus-sign icon-white"></i> Add Term
				</a>
		      	<a class="btn btn-success" title="Add Range" onclick="javascript: do_action('add range', 0);" href="#">
					<i class="icon-plus-sign icon-white"></i> Add Range
				</a>
			</span>
		</div>
		
		<div style="clear: both;"></div>
		
		<?php } else { ?>
			<h2>There is not Leasing Schema Data available.</h2>
		<?php }?>
	</form>
	
</div>