<?php 
	/* @var $form Quotegen_Form_Quote_Profitability */
	$form = $this->element;
	$quote = $form->getQuote();
	$isLeased = $quote->isLeased();
?>
<?php $this->headScript()->captureStart(); ?>
$(function() 
{
	$('#leasingSchema').change(function()
	{
		var value = this.value;
		$('#leasingSchemaTermId').empty().attr('disabled', 'disabled');
		if (value != 0)
		{
    		$.ajax(
    		{
    		    url:'<?php echo $this->url(array('format' => 'json', 'action' => 'leasing-schema-terms')); ?>/leasingSchemaId/' + value,
    		    success: function(data) 
    		    {
    		         var terms = data['leasingSchemaTerms'];
    		         var html = '';
    		         var len = terms.length;
    		         for (var i = 0; i < len; i++)
    		         {
    		             html += '<option value="' + terms[i].id + '">' + terms[i].months + ' Months</option>';
    		         }
    		         $('#leasingSchemaTermId').append(html);
    		         $('#leasingSchemaTermId').removeAttr('disabled');
    		    },
    		    error: function (data) 
    		    {
                    alert('Error Occured!');
    		    }
    		});
		}
	});
});
<?php $this->headScript()->captureEnd(); ?>
<table class="table table-condensed table-striped table-bordered">
    <tr>
        <th>Item</th>
        <th style="width: 75px;">Cost Per Unit</th>
        <th style="width: 80px;">Markup ($)</th>
        <th style="width: 80px;">Margin (%)</th>
        <th style="width: 65px;">Price Per Unit</th>
        <?php if ($isLeased) : ?>
        <th style="width: 80px;">Residual Per Unit ($)</th>
        <?php endif; ?>
        <th style="width: 60px;">Quantity</th>
        <th style="width: 80px;">Price</th>
        <?php if ($isLeased) : ?>
        <th style="width: 100px;">Monthly Subtotal</th>
        <?php endif; ?>
    </tr>
    <?php foreach ($quote->getQuoteDevices() as $quoteDevice) : /* @var $quoteDevice Quotegen_Model_QuoteDevice */ ?>
		<?php if ($quoteDevice->calculateTotalQuantity() > 0) : ?>
	    <tr>
	        <td><h5><?php echo $quoteDevice->getName() ?><br/><small><?php echo $quoteDevice->getSku() ?></small></h5></td>
			<td style="text-align: right;"><?php echo $this->currency($quoteDevice->calculatePackageCost()); ?></td>
			<td style="text-align: right;"><?php echo $form->getElement("packageMarkup_{$quoteDevice->getId()}"); ?></td>
			<td style="text-align: right;"><?php echo $form->getElement("margin_{$quoteDevice->getId()}"); ?></td>
			<td style="text-align: right;"><?php echo $this->currency( (float) $quoteDevice->calculatePackagePrice() ); ?></td>
			<?php if ($isLeased) : ?>
			<td style="text-align: right;"><?php echo $form->getElement("residual_{$quoteDevice->getId()}"); ?></td>
			<?php endif; ?>
			<td style="text-align: right;"><?php echo number_format($quoteDevice->calculateTotalQuantity()); ?></td>
			<td style="text-align: right;"><?php echo $this->currency( (float) $quoteDevice->calculateTotalPrice() ); ?></td>
			<?php if ($isLeased) : ?>
			<td style="text-align: right;"><?php echo $this->currency( (float) $quoteDevice->calculateTotalMonthlyLeasePrice() ); ?></td>
			<?php endif; ?>
	    </tr>
		<?php endif ?>
    <?php endforeach; ?>
    <tr>
        <?php if ($isLeased) : ?>
        <th colspan="7" style="text-align: right">Totals:</th>
        <?php else : ?>
        <th colspan="6" style="text-align: right">Totals:</th>
        <?php endif; ?>
        <th style="text-align: right;"><?php echo $this->currency((float) $quote->calculateTotalPrice() ); ?></th>
        <?php if ($isLeased) : ?>
        <th style="text-align: right;"><?php echo $this->currency((float) $quote->calculateTotalMonthlyLeasePrice() ); ?></th>
        <?php endif; ?>
    </tr>
</table>
<?php if ($isLeased) : ?>
<div class="clearfix">
    <div class="pull-right">
            <h4>Lease Term:
            <?php echo $form->getElement('leasingSchemaId')->renderViewHelper(); ?>
            <?php echo $form->getElement('leasingSchemaTermId')->renderViewHelper(); ?></h4>
    </div>
</div>
<hr>
<?php endif; ?>
<?php echo $form->getDisplayGroup('actions')->render(); ?>