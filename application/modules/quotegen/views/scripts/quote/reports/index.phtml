<?php 
$quote = $this->Quote(); /* @var $quote Quotegen_Model_Quote */
$this->activePage = 'reports';
echo $this->render('_partials/quoteHeading.phtml');
$this->headScript()->captureStart();
?>
$(function () {
    $(".downloadButton").click(function(e)
	{
	    e.preventDefault();
	    
    	var extension = "." + $(this).data('ext');
    	var loadingMessage = $(this).data('loadingmessage');
    	if (loadingMessage == null || loadingMessage.length < 1)
    	{
    		loadingMessage = "Please be patient while we generate your document. This normally takes a minute or two.";
    	}
    	var cancelled = false;
    	var xhr;
    	
        
        $("<div id='loading' style='text-align: center'></div>").append("<p>" + loadingMessage + "</p>").append("<div class='AjaxLoadingIcon'></div>").dialog({
            height: 200,
            width: 400,
            modal: true,
            draggable: false,
            resizable: false,
            title: "Generating Document...",
            closeOnEscape: false,
        	close: function(event, ui) {
        		if (xhr != null)
    			{
        			cancelled = true;
        			xhr.abort();
    			}
        	}
        });

        xhr = $.ajax({
            url: this.href,
            success: function(data) {
            	if (data.indexOf(extension) < 0 || data.length > 100)
            	{
            		// Debug Info for extension: 
            		//.append("<p>IndexOf Returned: " + data.indexOf(extension) + " for the extension " + extension +"</p>")
            		$("<div id='errorMessage'></div>").append(data).dialog({
            			height: 300,
            			width: 900,
            			modal: true,
            			draggable: true,
            			resizeable: true,
            			title: "Error",
        				buttons: {
        					Ok: function() {
        						$( this ).dialog( "close" );
        					}
        				}
            		});
            	}
            	else
            	{
            	    window.location.href = data;
            	}
            },
            error: function(data) {
            	if (!cancelled)
        		{
		        	$("<div id='errorMessage'></div>").append(data).dialog({
		    			height: 500,
		    			width: 900,
		    			modal: true,
		    			draggable: true,
		    			resizeable: true,
		    			title: "Error"
		    			
		    		});
        		}
            },
            complete: function(data) {
            	$("#loading").remove();
            	xhr = null;
            	cancelled = false;
            }
        });
    });
});
<?php $this->headScript()->captureEnd();?>
<ul class="thumbnails">
    <?php if ($quote->getQuoteType() == Quotegen_Model_Quote::QUOTE_TYPE_PURCHASED) : ?>
    <li class="span4">
        <h3>Report: Quote</h3>
        <div class="thumbnail">
            <img src="http://placehold.it/300x200" />
            <hr />
            <p class="clearfix">
                <a class="downloadButton btn btn-primary" data-ext="docx" href="<?php echo $this->url(array('action' => 'purchase-quote', 'format' => 'docx')); ?>">Download Quote</a>
                <a class="pull-right btn" href="<?php echo $this->url(array('action' => 'purchase-quote')); ?>">HTML Preview</a>
            </p>
            <p>Insert a description here about a quote that is to be purchased.</p>
        </div>                    
    </li>
    <?php elseif ($quote->getQuoteType() == Quotegen_Model_Quote::QUOTE_TYPE_LEASED) : ?>
    <li class="span4">
        <h3>Report: Quote</h3>
        <div class="thumbnail">
            <img src="http://placehold.it/300x200" />
            <hr />
            <p class="clearfix">
                <a class="downloadButton btn btn-primary" data-ext="docx" href="<?php echo $this->url(array('action' => 'lease-quote', 'format' => 'docx')); ?>">Download Quote</a>
                <a class="pull-right btn" href="<?php echo $this->url(array('action' => 'lease-quote')); ?>">HTML Preview</a>
            </p>
            <p>Insert a description here about a quote that is to be leased.</p>
        </div>                    
    </li>
    <?php endif; ?>
    <li class="span4">
        <h3>Report: Order Summary</h3>
        <div class="thumbnail">
            <img src="http://placehold.it/300x200" />
            <hr />
            <p class="clearfix">
                <a class="pull-right btn" href="<?php echo $this->url(array('action' => 'order-list')); ?>">HTML Preview</a>
            </p>
            <p>Insert a description here about the order summary.</p>
        </div>                    
    </li>
</ul>
<div class="well">
    <?php echo $this->navigationForm; ?>
</div>