<?php 
$quote = $this->Quote(); /* @var $quote Quotegen_Model_Quote */
$devices = $this->devices;
$this->placeholder('ProgressionNav')->set($this->render('_partials/quoteHeading.phtml'));
$this->headScript()->appendScript("$('i').popover();");
?>

<div class="well">
<div class='pull-right' style='padding: 7px;'>
	<a href="<?php echo $this->url(array('action' => 'sync-all-device-configurations')); ?>" title="Sync all configurations with current information." class="btn btn-info "><i class="icon-refresh"></i> Sync All Devices</a>
</div>

<table class="table table-condensed table-bordered table-striped quoteDeviceTable">
	<tr class="header-row">
    	<th colspan="12">
    		<div  class='pull-right'>
                <?php echo $this->addFavoriteDeviceForm;?>
            </div>
			<?php echo $this->addDeviceForm;?>
		</th>
	</tr>
    <tr class="header-row">
    	<th>Item</th>
        <th style="width: 1;">Sku</th>
        <th>Description</th>
        <th style="width: 70px;">Cost</th>
        <th style="width: 60px;">Quantity</th>
        <th>Subtotal </th>
        <th style="width: 30px"></th>
	</tr>
    <?php /* @var $device Quotegen_Model_QuoteDevice */foreach ($devices as $device) : ?>
    <tr class="deviceRow">
    	<td><h4><?php echo $device->name; ?></h4></td>
        <td><h4><?php echo $device->oemSku; ?></h4></td>
        <td></td>
        <td style="text-align: right"><h4><?php echo $this->currency((float)$device->cost)?></h4></td>
        <td></td>
        <td style="text-align: right"><h4><?php echo $this->currency((float)$device->cost) ?></h4></td>
        <td>
        	<div class="btn-group">
        		<a href="#" class="btn btn-mini btn-primary dropdown-toggle" data-toggle="dropdown"><i class="icon-wrench"></i></a>
        		<ul class="dropdown-menu pull-right">
        		<?php if ($device->getDevice()) : ?>
	            	<li><a href="<?php echo $this->url(array('action' => 'sync-device-configuration', 'id' => $device->id)); ?>"><i class="icon-refresh"></i> Sync Device</a>
            	<?php endif; ?>
	            	<li><a href="<?php echo $this->url(array('action' => 'edit-quote-device', 'id' => $device->id)); ?>"><i class="icon-pencil"></i> Edit Device</a>
            		<li><a href="<?php echo $this->url(array('action' => 'delete-quote-device', 'id' => $device->id)); ?>"><i class="icon-trash"></i> Delete Device</a>
				</ul>
			</div>
        </td>
	</tr>
	<?php if (count($device->getQuoteDeviceOptions()) > 0) : ?>
    	<?php foreach ($device->getQuoteDeviceOptions() as $quoteDeviceOption) : /* @var $quoteDeviceOption Quotegen_Model_QuoteDeviceOption */ ?>
    	<tr class="optionRow">
	    	<td style="padding-left: 25px;"><?php echo $quoteDeviceOption->name; ?></td>
    	    <td><?php echo $quoteDeviceOption->oemSku; ?></td>
        	<td><?php echo $quoteDeviceOption->description; ?></td>
	        <td style="text-align: right"><?php echo '$'.number_format($quoteDeviceOption->cost,2); ?></td>
    	    <td style="text-align: right"><?php echo number_format($quoteDeviceOption->quantity); ?></td>
        	<td style="text-align: right"><?php echo '$'.number_format($quoteDeviceOption->getTotalCost(),2); ?></td>
	        <td></td>
		</tr>
    <?php endforeach; ?>
    <?php endif; ?>
    <tr>
    	<td colspan='5' style='text-align: right'><strong> Package Cost </strong></td>
    	<td style='text-align: right'><?php echo '$'. number_format($device->calculatePackageCost(),2);?></td>
    	<td></td>
    </tr>
    <tr>
    	<td colspan='7'>&nbsp;</td>
    </tr>
    <?php endforeach; ?>
    <tr class="header-row">
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
   		<th></th>
        <th></th>
    </tr>
</table>

	<?php echo $this->navigationForm; ?>
</div>
