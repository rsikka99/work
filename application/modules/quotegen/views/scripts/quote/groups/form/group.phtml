<?php 
	/* @var $form Quotegen_Form_Quote_Group */
	$form = $this->element;
	$addDeviceToGroupSubform = $form->getSubForm('addDeviceToGroup');
	$deviceQuantitySubform = $form->getSubForm('deviceQuantity');
	$addGroupSubform = $form->getSubForm('addGroup');
	
	$deleteDeviceButton = $deviceQuantitySubform->getElement('deleteDeviceFromGroup');
	
	// Get elements in the form 
	$deviceElement = $addDeviceToGroupSubform->getElement('devices');
	$quantityElement = $addDeviceToGroupSubform->getElement('quantity');
	$groupElement = $addDeviceToGroupSubform->getElement('groups');
?>

<form id="<?php echo $form->getId(); ?>" class='<?php echo $form->getAttrib('class') ?>' action="<?php echo $form->getAction() ?>" method="<?php echo $form->getMethod() ?>" name="<?php echo $form->getName() ?>">
	<table>
		<tr>
			<td><?php echo $addDeviceToGroupSubform->getElement('addDevice'); ?></td>
			<td><?php echo $quantityElement; ?></td>
			<td> of the </td>
			<td><?php echo $deviceElement; ?></td>
			<td> device to the </td>
			<td><?php echo $groupElement; ?></td>
			<td> group.</td>
		</tr>
	</table>
	<br/>
	<?php echo $addGroupSubform->getElement('addGroup'); ?>
	<?php echo $addGroupSubform->getElement('name'); ?> 


    <?php /* @var $deviceGroup Quotegen_Model_QuoteDeviceGroup */$deviceGroups = $form->getQuote()->getQuoteDeviceGroups();?>
    <?php foreach ($deviceGroups as $deviceGroup) : ?>	
    <h3> <?php echo $deviceGroup->getName(); ?></h3>
    <table class='table table-bordered table-striped table-condensed'>
    	<tr>
    		<th style='width: 200px'>Device</th>
    		<th >Sku</th>
    		<th style='width: 150px'>Quantity</th>
    		<th style='width: 30px'></th>
    	</tr>
    	<?php $quoteDeviceGroupDevices = $deviceGroup->getQuoteDeviceGroupDevices();?>
    	<?php /* @var $quoteDeviceGroupDevice Quotegen_Model_QuoteDeviceGroupDevice */ foreach ($quoteDeviceGroupDevices as $quoteDeviceGroupDevice) : ?>
    	<tr>
    		<td><?php echo $quoteDeviceGroupDevice->getQuoteDevice()->getName() ?></td>
    		<td><?php echo $quoteDeviceGroupDevice->getQuoteDevice()->getSku() ?></td>
    		<td><?php echo $deviceQuantitySubform->getElement("quantity_{$quoteDeviceGroupDevice->getQuoteDeviceGroupId()}_{$quoteDeviceGroupDevice->getQuoteDeviceId()}"); ?></td>
    		<td><?php $deleteDeviceButton->setValue("{$quoteDeviceGroupDevice->getQuoteDeviceGroupId()}_{$quoteDeviceGroupDevice->getQuoteDeviceId()}");
    		    echo $deleteDeviceButton; 
    		?></td>
    	</tr>
    	<?php endforeach ?>
    </table>
    <?php endforeach ?>
    
    <?php echo $form->getDisplayGroup('actions')->render(); ?>
</form>