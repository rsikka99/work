<?php
/* @var $optimization Hardwareoptimization_ViewModel_Optimization */
$optimization = $this->optimization;
/* @var $section PHPWord_Section */
$section = $this->section;
/* @var $profitabiltyDevices Hardwareoptimization_Model_Optimization_Dealer */
$profitabiltyDevices = $this->profitabilityDevices;

$deviceCount           = count($profitabiltyDevices->kept);
$totalPurchasedDevices = count($optimization->getDevices()->purchasedDeviceInstances->getDeviceInstances());
$section->addTitle($this->translate("Acceptable Devices ({$deviceCount} of {$totalPurchasedDevices}) "), 2);
$section->addText($this->translate('The following devices have been deemed productive and we suggest keeping these devices.'));

// Table with values
$tcStyle = $this->devicetables->tables->acceptable;
$table   = $section->addTable($tcStyle->tablestyle);
// Table header
$table->addRow($tcStyle->body->rowheight);
$table->addCell($tcStyle->col1Width, $tcStyle->header->header->cellStyle)->addText($this->translate('Device Name'), $tcStyle->header->header->fontStyle, $tcStyle->header->header->paragraphStyle);
$table->addCell($tcStyle->col2Width, $tcStyle->header->header->cellStyle)->addText($this->translate('Serial / IP Address'), $tcStyle->header->header->fontStyle, $tcStyle->header->header->paragraphStyle);
$table->addCell($tcStyle->col3Width, $tcStyle->header->header->cellStyle)->addText($this->translate('Mono AMPV'), $tcStyle->header->header->fontStyle, $tcStyle->header->header->paragraphStyle);
$table->addCell($tcStyle->col4Width, $tcStyle->header->header->cellStyle)->addText($this->translate('Color AMPV'), $tcStyle->header->header->fontStyle, $tcStyle->header->header->paragraphStyle);

// Begin with data rows
foreach ($profitabiltyDevices->kept as $device)
{
    $isColor = $device->getMasterDevice()->isColor();
    $cycle   = ($this->cycle(array(true, false))->next()->current());
    if ($cycle)
    {
        $ampvStyle = $tcStyle->body->cell3->even;
        $style     = $tcStyle->body->cell1->even;
    }
    else
    {
        $ampvStyle = $tcStyle->body->cell3->odd;
        $style     = $tcStyle->body->cell1->odd;
    }

    $table->addRow($tcStyle->body->rowheight);

    $cell = $table->addCell($tcStyle->collWidth, $style);
    $cell->addText($device->getMasterDevice()->getManufacturer()->fullname, $tcStyle->body->cell1->manufacturerName->fontStyle, $tcStyle->body->cell1->manufacturerName->paragraphStyle);
    $cell->addText($device->getMasterDevice()->modelName, $tcStyle->body->cell1->modelName->fontStyle, $tcStyle->body->cell1->modelName->paragraphStyle);

    $cell2 = $table->addCell($tcStyle->col2Width, $style);
    $cell2->addText($device->serialNumber, $tcStyle->body->cell2->fontStyle, $tcStyle->body->cell2->paragraphStyle);
    $cell2->addText($device->ipAddress, $tcStyle->body->cell2->fontStyle, $tcStyle->body->cell2->paragraphStyle);
    $table->addCell($tcStyle->col3Width, $ampvStyle)->addText(number_format($device->getPageCounts()->monochrome->getMonthly()), $tcStyle->body->cell3->fontStyle, $tcStyle->body->cell3->paragraphStyle);
    $table->addCell($tcStyle->col4Width, $ampvStyle)->addText(($isColor) ? number_format($device->getPageCounts()->color->getMonthly()) : 'N/A', $tcStyle->body->cell4->fontStyle, $tcStyle->body->cell4->paragraphStyle);
}

$section->addTextBreak();
$section->addTitle($this->translate('Number of Printing Device Models and Supply Types'), 2);
$section->addText(sprintf($this->translate('Out of your %1$s networked printing devices, you have of %2$s different models. Each section of the chart below represents a single model type. We estimate that %3$s of your printing devices are leased machines, for which supplies are included in your contract. The %4$s remaining machines consist of %5$s different models and use %6$s different supply types. If you hold two of each supply in inventory, you have an estimated $%7$s in operating cash held in printer supplies inventory at any given time.'), number_format(count($optimization->getDevices()->purchasedDeviceInstances->getDeviceInstances())), number_format($optimization->getNumberOfUniqueModels()), number_format(count($optimization->getDevices()->leasedDeviceInstances->getDeviceInstances())), number_format(count($optimization->getDevices()->purchasedDeviceInstances->getDeviceInstances())), number_format($optimization->getNumberOfUniquePurchasedModels()), number_format($optimization->getNumberOfUniquePurchasedToners()), number_format($optimization->getCashHeldInInventory())));
$section->addTextBreak();

$section->addImage($this->graphs [12], array('align' => 'center'));
$section->addImage($this->graphs [13], array('align' => 'center'));
$section->addTextBreak();

$section->addText($this->translate('By using printing devices with the same supplies, you can minimize the amount of operating cash held up in supplies inventory and the amount of storage space required.
Office Depot can provide you with just-in-time supplies fulfillment, which can further reduce your inventory requirements and emergency supply orders.'));

$section->addTitle($this->translate('Color Usage'), 2);
$section->addText(sprintf($this->translate('You currently have %1$s color printing devices that print a monthly average of %2$s color pages per month, which is %3$s%% of your total monthly print volume.'), number_format($optimization->getNumberOfColorCapableDevices()), number_format($optimization->getDevices()->allIncludedDeviceInstances->getPageCounts()->color->getMonthly()), number_format(($optimization->getPercentages()->TotalColorPercentage * 100), 2)));

$section->addText($this->translate('Overall, printing in color is more expensive than printing in monochrome. The ideal amount of color usage depends on your printing needs, but the use of color in important documents can enhance your
company\'s professional image, improve comprehension and increase readership. Office Depot can help you track your color printing and provide low-cost color hardware options.'));

$tcStyle    = $this->twocenter;
$imageTable = $section->addTable($tcStyle->tablestyle);
$imageTable->addRow();
$imageTable->addCell($tcStyle->col1Width)->addImage($this->graphs [14], $tcStyle->image->cell1);
$imageTable->addCell($tcStyle->col2Width)->addImage($this->graphs [15], $tcStyle->image->cell2);