<?php
/* @var $hardwareOptimization Hardwareoptimization_Model_Hardware_Optimization */
$hardwareOptimization = $this->hardwareOptimization;

/* @var $optimization Hardwareoptimization_ViewModel_Optimization */
$optimization = $this->optimization;

/* @var $customerOptimization Hardwareoptimization_Model_Optimization_Customer */
$customerOptimization = $this->customerOptimization;

/* @var $graphs array */
$graphs = $this->graphs;

/* @var $section \PhpOffice\PhpWord\Element\Section */
$section = $this->section;

$deviceInstances = $optimization->getDevicesGroupedByAction();

$totalNumberOfDevices = $optimization->getDevices()->purchasedDeviceInstances->getCount();

$section->addPageBreak();

$section->addTitle('Device Appendix (' . number_format($totalNumberOfDevices) . " devices)", 2);

$this->partial('report/customer/optimization/docx/device_table.phtml',
    array(
        "section"                => $section,
        "title"                  => "Acceptable Devices",
        "description"            => "The following devices have been deemed productive and we suggest keeping these devices.",
        "deviceInstances"        => (isset($deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_KEEP])) ? $deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_KEEP] : array(),
        "showReplacementDevices" => false,
        "hardwareOptimization"   => $hardwareOptimization,
        "totalNumberOfDevices"   => $totalNumberOfDevices,
        "showReason"             => false,
        "tcStyle"                => $this->devicetables->tables->acceptable,
        "tableStyle"             => $this->styles->tables,
    )
);

$section->addTextBreak();

$this->partial('report/customer/optimization/docx/device_table.phtml',
    array(
        "section"                => $section,
        "title"                  => "Suggested Replacement Devices",
        "description"            => "The following devices have been targeted for replacement.",
        "deviceInstances"        => (isset($deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_RETIRE])) ? $deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_RETIRE] : array(),
        "showReplacementDevices" => true,
        "hardwareOptimization"   => $hardwareOptimization,
        "totalNumberOfDevices"   => $totalNumberOfDevices,
        "showReason"             => true,
        "tcStyle"                => $this->devicetables->tables->replacement,
        "tableStyle"             => $this->styles->tables,
    )
);

$section->addTextBreak();

$this->partial('report/customer/optimization/docx/device_table.phtml',
    array(
        "section"                => $section,
        "title"                  => "Devices Eligible for Retirement",
        "description"            => "Devices with both low volume and age of over " . Proposalgen_Model_DeviceInstance::RETIREMENT_AGE . " years have been targeted for retirement. We suggest migrating the page volume into another device.",
        "deviceInstances"        => (isset($deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_RETIRE])) ? $deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_RETIRE] : array(),
        "showReplacementDevices" => false,
        "hardwareOptimization"   => $hardwareOptimization,
        "totalNumberOfDevices"   => $totalNumberOfDevices,
        "showReason"             => false,
        "tcStyle"                => $this->devicetables->tables->retire,
        "tableStyle"             => $this->styles->tables,
    )
);

$section->addTextBreak();

$this->partial('report/customer/optimization/docx/device_table.phtml',
    array(
        "section"                => $section,
        "title"                  => "Devices flagged as Do Not Repair",
        "description"            => "These devices have been flagged for replacement on breakdown based on operational reliability.",
        "deviceInstances"        => (isset($deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_DNR])) ? $deviceInstances[Hardwareoptimization_Model_Hardware_Optimization_DeviceInstance::ACTION_DNR] : array(),
        "showReplacementDevices" => false,
        "hardwareOptimization"   => $hardwareOptimization,
        "totalNumberOfDevices"   => $totalNumberOfDevices,
        "showReason"             => true,
        "tcStyle"                => $this->devicetables->tables->flagged,
        "tableStyle"             => $this->styles->tables,
    )
);
?>